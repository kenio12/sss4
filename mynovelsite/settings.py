"""
Django settings for mynovelsite project.

Generated by 'django-admin startproject' using Django 3.2.24.

For more information on this file, see
https://docs.djangoproject.com/en/3.2/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/3.2/ref/settings/
"""

import os  # osãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
from pathlib import Path
import environ

env = environ.Env()
environ.Env.read_env()  # .envãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ç’°å¢ƒå¤‰æ•°ã‚’èª­ã¿è¾¼ã‚€

BASE_DIR = Path(__file__).resolve().parent.parent


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/3.2/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = env('DJANGO_SECRET_KEY', default=os.getenv('DJANGO_SECRET_KEY', 'django-insecure-dev-key-please-change-in-production'))


# Debugè¨­å®š
DEBUG = os.environ.get('DEBUG', 'False').lower() == 'true'

# ALLOWED_HOSTS with proper whitespace handling
hosts = os.getenv('DJANGO_ALLOWED_HOSTS', 'localhost').split(',')
ALLOWED_HOSTS = [host.strip() for host in hosts if host.strip()]


# Application definition

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'novels',  # novelsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
    'accounts',  # accountsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
    'home',  # homeã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
    'django.contrib.humanize',
    'django_extensions',
    'games',
    'game_same_title',
    'adminpanel',
    'game_maturi',
    'widget_tweaks',  # ã“ã®è¡Œã‚’è¿½åŠ 
    'novel_site',  # â† ã“ã‚Œã‚’è¿½åŠ 
    'announcements.apps.AnnouncementsConfig',
    'django_celery_beat',  # ã“ã‚Œã‚’è¿½åŠ 
    'contacts.apps.ContactsConfig',  # ã“ã‚Œã‚’è¿½åŠ 
    'django_celery_results',
]

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'whitenoise.middleware.WhiteNoiseMiddleware',  # ã“ã“ã«ç§»å‹•
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
    'middleware.RedirectMiddleware',  # ã—ã„ã‚¹ã§è¿½åŠ 
    'game_same_title.middleware.SameTitleAccessLogMiddleware',  # ğŸ”¥ ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°è¨˜éŒ²ï¼ˆèª°ãŒã„ã¤ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‹æ°¸ä¹…ä¿å­˜ï¼‰
]

ROOT_URLCONF = 'mynovelsite.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [os.path.join(BASE_DIR, 'templates')],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
                'novels.context_processors.latest_unread_novels',  # ã“ã‚Œã ã‘æ®‹ã™
            ],
        },
    },
]

WSGI_APPLICATION = 'mynovelsite.wsgi.application'


# Database
# https://docs.djangoproject.com/en/3.2/ref/settings/#databases

# å‰ã€…ã®çŸ­ç·¨å°èª¬ä¼šã®ãƒ‡ãƒ¼ã‚¿ã‚‚å–ã‚Šè¾¼ã‚€ãœï¼

import dj_database_url


# ç’°å¢ƒå¤‰æ•°ã‹ã‚‰å®Ÿè¡Œç’°å¢ƒã‚’å–å¾—ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯é–‹ç™ºç’°å¢ƒï¼‰
ENVIRONMENT = os.getenv('ENVIRONMENT', 'development').lower()

if ENVIRONMENT == 'production':
    # Herokuã®ç’°å¢ƒã§ã‚ã‚Œã°ã€DATABASE_URLã‹ã‚‰è¨­å®šã‚’ä¸Šæ›¸ã
    DATABASES = {
        'default': dj_database_url.config(conn_max_age=600, ssl_require=True)
    }
elif ENVIRONMENT == 'test':
    # ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯Docker Composeã‹ã‚‰æ¸¡ã•ã‚Œã‚‹DATABASE_URLã‚’ãã®ã¾ã¾åˆ©ç”¨ã™ã‚‹
    DATABASES = {
        'default': dj_database_url.config(
            default=os.getenv('DATABASE_URL', 'postgres://postgres:postgres@test_db:5432/novel_test'),
            conn_max_age=0
        )
    }
else:
    # é–‹ç™ºç’°å¢ƒã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š
    DATABASES = {
        'default': {
            'ENGINE': 'django.db.backends.postgresql',
            'NAME': os.getenv('DEV_POSTGRES_DB', 'novel_site_db'),
            'USER': os.getenv('DEV_POSTGRES_USER', 'postgres'),
            'PASSWORD': os.getenv('DEV_POSTGRES_PASSWORD', 'your_password_here'),
            'HOST': os.getenv('DEV_POSTGRES_HOST', 'db'),
            'PORT': os.getenv('DEV_POSTGRES_PORT', '5432'),
        },
        'old_db': {
            'ENGINE': 'django.db.backends.postgresql',
            'NAME': os.getenv('OLD_POSTGRES_DB', 'old_sss_novels'),
            'USER': os.getenv('OLD_POSTGRES_USER', 'postgres'),
            'PASSWORD': os.getenv('OLD_POSTGRES_PASSWORD', 'your_password_here'),
            'HOST': os.getenv('OLD_POSTGRES_HOST', 'old_db'),
            'PORT': os.getenv('OLD_POSTGRES_PORT', '5432'),
        }
    }

# Authentication Backends
AUTHENTICATION_BACKENDS = [
    'accounts.authentication.EmailOrNicknameBackend',  # ã‚«ã‚¹ã‚¿ãƒ èªè¨¼ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
    'django.contrib.auth.backends.ModelBackend',  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®èªè¨¼ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
]

AUTH_USER_MODEL = 'accounts.User'

# Password validation
# https://docs.djangoproject.com/en/3.2/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]


# Internationalization
# https://docs.djangoproject.com/en/3.2/topics/i18n/

LANGUAGE_CODE = 'ja'

TIME_ZONE = 'Asia/Tokyo'

USE_I18N = True

USE_L10N = True

USE_TZ = True


# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/3.2/howto/static-files/

STATIC_URL = '/static/'
STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')

# WhiteNoiseã®è¨­å®š
STATICFILES_STORAGE = 'whitenoise.storage.CompressedManifestStaticFilesStorage'

# WhiteNoiseã®è¿½åŠ è¨­å®šï¼ˆç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¯¾å¿œï¼‰
WHITENOISE_MAX_AGE = 31536000  # 1å¹´é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥
WHITENOISE_SKIP_COMPRESS_EXTENSIONS = ['png', 'jpg', 'jpeg', 'gif', 'webp', 'svg']

# é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªè¨­å®š
STATICFILES_DIRS = [
    os.path.join(BASE_DIR, 'static'),
]

# staticfilesãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
os.makedirs(os.path.join(BASE_DIR, 'static'), exist_ok=True)
os.makedirs(os.path.join(BASE_DIR, 'staticfiles'), exist_ok=True)

# Default primary key field type
# https://docs.djangoproject.com/en/3.2/ref/settings/#default-auto-field

DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'

# Email configuration for production
EMAIL_BACKEND = 'utils.mail_backends.CustomEmailBackend'  # ã‚«ã‚¹ã‚¿ãƒ SMTPãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’ä½¿ç”¨
EMAIL_HOST = os.getenv('EMAIL_HOST', 'smtp.gmail.com')  # ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼ã®ãƒ›ã‚¹ãƒˆåï¼ˆç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—ï¼‰
EMAIL_PORT = int(os.getenv('EMAIL_PORT', '587'))  # ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼ã®ãƒãƒ¼ãƒˆï¼ˆç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—ï¼‰
EMAIL_HOST_USER = os.getenv('EMAIL_HOST_USER', 'your_email@example.com')  # ç’°å¢ƒå¤‰æ•°ã‹ã‚‰ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å–å¾—
EMAIL_HOST_PASSWORD = os.getenv('EMAIL_HOST_PASSWORD', 'your_email_password_here')  # ç’°å¢ƒå¤‰æ•°ã‹ã‚‰ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å–å¾—
EMAIL_USE_TLS = os.getenv('EMAIL_USE_TLS', 'True') == 'True'  # TLSã‚’ä½¿ç”¨ï¼ˆç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—ï¼‰
# EMAIL_USE_SSL = False  # SSLã‚’ä½¿ç”¨ã—ãªã„ï¼ˆTLSã¨SSLã®ä¸¡æ–¹ã‚’Trueã«ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ï¼‰
DEFAULT_FROM_EMAIL = os.getenv('DEFAULT_FROM_EMAIL', 'no-reply@sss4.life')  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®é€ä¿¡å…ƒãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹

# ãƒ¡ãƒ¼ãƒ«ã§ä½¿ç”¨ã™ã‚‹ãƒ™ãƒ¼ã‚¹URLã®è¨­å®š
# é–‹ç™ºç’°å¢ƒã§ã¯ 'http://localhost:8000' ãªã©ã€æœ¬ç•ªç’°å¢ƒã§ã¯å®Ÿéš›ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¨­å®š
BASE_URL = os.getenv('BASE_URL', 'http://localhost:8000')

# HTTPSç’°å¢ƒã§ã®ã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³Cookieã‚’é€ä¿¡
SESSION_COOKIE_SECURE = True
# ãƒ–ãƒ©ã‚¦ã‚¶ãŒJavaScriptã‚’é€šã˜ã¦ã‚»ã‚·ãƒ§ãƒ³Cookieã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã®ã‚’é˜²ã
SESSION_COOKIE_HTTPONLY = True
# ã‚»ãƒƒã‚·ãƒ§ãƒ³Cookieã‚’é€ä¿¡ã™ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’æŒ‡å®šï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
# SESSION_COOKIE_DOMAIN = 'yourdomain.com'

# ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ã‚’1åˆ†é–“ã«è¨­å®š
PASSWORD_RESET_TIMEOUT = 300  # ç§’å˜ä½ã§æŒ‡å®š

# Dockerç’°å¢ƒã§ã®è¨­å®š
import socket
hostname, _, ips = socket.gethostbyname_ex(socket.gethostname())
INTERNAL_IPS = [ip[:-1] + "1" for ip in ips]
# ã¾ãŸã¯ã€ã‚ˆã‚Šã‚·ãƒ³ãƒ—ãƒ«ã«è¨­å®šã™ã‚‹å ´åˆ
# INTERNAL_IPS = ['127.0.0.1', '192.168.10.1']  # 192.168.10.1ã¯Dockerãƒ›ã‚¹ãƒˆã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ä¾‹

# Celery Configuration
if ENVIRONMENT == 'production':
    # æœ¬ç•ªç’°å¢ƒè¨­å®šï¼ˆRedisã‚’ä½¿ç”¨ï¼‰
    CELERY_BROKER_URL = 'redis://redis:6379/0'
    CELERY_RESULT_BACKEND = 'redis://redis:6379/0'
else:
    # é–‹ç™ºç’°å¢ƒè¨­å®šï¼ˆRedisã‚’ä½¿ç”¨ï¼‰
    CELERY_BROKER_URL = 'redis://redis:6379/0'
    CELERY_RESULT_BACKEND = 'redis://redis:6379/0'

# å…±é€šã®Celeryè¨­å®š
CELERY_ACCEPT_CONTENT = ['json']
CELERY_TASK_SERIALIZER = 'json'
CELERY_RESULT_SERIALIZER = 'json'
CELERY_TIMEZONE = 'Asia/Tokyo'
CELERY_ENABLE_UTC = True
CELERY_BROKER_CONNECTION_RETRY_ON_STARTUP = True

if ENVIRONMENT == 'development':
    print(f"[DEBUG] Environment: {ENVIRONMENT}")
    print(f"[DEBUG] CELERY_BROKER_URL: {CELERY_BROKER_URL}")
    print(f"[DEBUG] CELERY_RESULT_BACKEND: {CELERY_RESULT_BACKEND}")

LOG_LEVEL = os.getenv('DJANGO_LOG_LEVEL', 'DEBUG' if ENVIRONMENT == 'development' else 'INFO')
DB_LOG_LEVEL = os.getenv('DJANGO_DB_LOG_LEVEL', 'INFO' if ENVIRONMENT == 'development' else 'WARNING')
if ENVIRONMENT == 'test':
    LOG_LEVEL = os.getenv('DJANGO_LOG_LEVEL', 'WARNING')
    DB_LOG_LEVEL = os.getenv('DJANGO_DB_LOG_LEVEL', 'ERROR')

LOGGING = {
    "version": 1,
    "disable_existing_loggers": False,
    "formatters": {
        "local": {
            "format": '%(asctime)s [%(levelname)s] %(pathname)s:%(lineno)d %(message)s'
        }
    },
    "handlers": {
        "console": {
            "class": "logging.StreamHandler",
            "formatter": "local"
        }
    },
    "root": {
        "handlers": ["console"],
        "level": LOG_LEVEL,
        "propagate": True
    },
    "loggers": {
        'django': {
           'handlers': ['console'],
           'level': LOG_LEVEL,
           'propagate': True,
        },
        'django.db.backends': {
            'handlers': ['console'],
            'level': DB_LOG_LEVEL,
            'propagate': True,
        },
        'game_same_title.views': {
            'handlers': ['console'],
            'level': LOG_LEVEL,
            'propagate': True,
        },
        'game_maturi.views': {
            'handlers': ['console'],
            'level': LOG_LEVEL,
            'propagate': True,
        },
    }
}

ALLOWED_HOSTS = os.getenv('DJANGO_ALLOWED_HOSTS', 'localhost').split(',')

# # é–‹ç™ºç’°å¢ƒã§ã®ã¿æ—¥ä»˜ã‚’å›ºå®š
# if DEBUG:
#     freeze_time("2024-12-16").start()

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
# æœ¬ç•ªç’°å¢ƒã§ã®ã¿æœ‰åŠ¹ã«ã™ã‚‹è¨­å®š
if ENVIRONMENT == 'production':
    # HTTPSè¨­å®š
    SECURE_SSL_REDIRECT = True
    SECURE_PROXY_SSL_HEADER = ('HTTP_X_FORWARDED_PROTO', 'https')
    
    # CSRFã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
    CSRF_COOKIE_SECURE = True
    SESSION_COOKIE_SECURE = True
    SESSION_COOKIE_HTTPONLY = True
    
    # HSTSã®è¨­å®š
    SECURE_HSTS_SECONDS = 31536000  # 1å¹´
    SECURE_HSTS_INCLUDE_SUBDOMAINS = True
    SECURE_HSTS_PRELOAD = True
else:
    # é–‹ç™ºç’°å¢ƒã§ã¯ç„¡åŠ¹
    SECURE_SSL_REDIRECT = False
    CSRF_COOKIE_SECURE = False
    SESSION_COOKIE_SECURE = False
    SESSION_COOKIE_HTTPONLY = True  # ã“ã‚Œã¯é–‹ç™ºç’°å¢ƒã§ã‚‚æœ‰åŠ¹ã«ã—ã¦ãŠã

# =============================================
# Sentryè¨­å®šï¼ˆã‚¨ãƒ©ãƒ¼ç›£è¦–ãƒ»é€šçŸ¥ï¼‰
# =============================================

try:
    import sentry_sdk
    from sentry_sdk.integrations.django import DjangoIntegration
    SENTRY_AVAILABLE = True
except ImportError:
    SENTRY_AVAILABLE = False

# Sentryèª¤æ¤œçŸ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆbefore_sendé–¢æ•°ï¼‰
def before_send(event, hint):
    """
    Sentryã«é€ä¿¡ã™ã‚‹å‰ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    èª¤æ¤œçŸ¥ï¼ˆ404ã€ãƒœãƒƒãƒˆã€healthcheckç­‰ï¼‰ã‚’é™¤å¤–
    """
    # ç„¡è¦–ã™ã‚‹ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—
    ignore_errors = [
        "DoesNotExist",           # Django ORM: ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒå­˜åœ¨ã—ãªã„
        "NotFound",               # 404ã‚¨ãƒ©ãƒ¼
        "ConnectionRefusedError", # ä¸€æ™‚çš„ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å•é¡Œ
        "BrokenPipeError",        # uWSGI/Gunicornå†èµ·å‹•æ™‚ã«ã‚ˆãã‚ã‚‹
    ]

    if 'exc_info' in hint:
        exc_type, exc_value, tb = hint['exc_info']
        if exc_type.__name__ in ignore_errors:
            return None  # ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡ã—ãªã„

    # 404ã‚¨ãƒ©ãƒ¼ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    if event.get('request', {}).get('url'):
        url = event['request']['url']
        # healthcheckã‚„pingç³»ã®URLã¯ç„¡è¦–
        if '/healthcheck/' in url or '/ping/' in url or '/health/' in url:
            return None

    # ãƒœãƒƒãƒˆãƒ»ã‚¯ãƒ­ãƒ¼ãƒ©ãƒ¼ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç„¡è¦–
    if event.get('request', {}).get('headers', {}).get('User-Agent'):
        user_agent = event['request']['headers']['User-Agent'].lower()
        bot_keywords = ['bot', 'crawler', 'spider', 'scraper', 'googlebot', 'bingbot']
        if any(keyword in user_agent for keyword in bot_keywords):
            return None

    return event  # ãã®ä»–ã®ã‚¤ãƒ™ãƒ³ãƒˆã¯é€ä¿¡

# æœ¬ç•ªç’°å¢ƒã®ã¿Sentryã‚’æœ‰åŠ¹åŒ–
if ENVIRONMENT == 'production' and SENTRY_AVAILABLE:
    sentry_sdk.init(
        dsn=os.getenv('SENTRY_DSN', ''),
        integrations=[
            DjangoIntegration(),
        ],
        before_send=before_send,
        # ãƒˆãƒ¬ãƒ¼ã‚¹ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆï¼ˆ0%ã«è¨­å®š = ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–å®Œå…¨ã‚ªãƒ•ï¼‰
        traces_sample_rate=0.0,
        # ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆï¼ˆ0%ã«è¨­å®š = ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°å®Œå…¨ã‚ªãƒ•ï¼‰
        profiles_sample_rate=0.0,
        # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè­˜åˆ¥ï¼ˆnovel_siteã®ã‚¨ãƒ©ãƒ¼ã¨æ˜ç¤ºï¼‰
        environment="novel_site",
        # ã‚¿ã‚°è¿½åŠ ï¼ˆã‚¨ãƒ©ãƒ¼ä¸€è¦§ã§è¦‹ã‚„ã™ãï¼‰
        _experiments={
            "auto_enabling_integrations": True
        },
        # PIIï¼ˆå€‹äººæƒ…å ±ï¼‰é€ä¿¡è¨­å®š
        send_default_pii=False,
    )
    # ã‚¿ã‚°ã‚’å…¨ã‚¤ãƒ™ãƒ³ãƒˆã«è¿½åŠ 
    from sentry_sdk import configure_scope
    with configure_scope() as scope:
        scope.set_tag("project", "novel_site")
        scope.set_tag("app", "sss4")

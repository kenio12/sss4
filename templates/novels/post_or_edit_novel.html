{% extends 'base.html' %}
{% load static %}
{% load widget_tweaks %}  <!-- widget_tweaksã‚’ãƒ­ãƒ¼ãƒ‰ -->

{% block content %}
{% if novel.id and novel.content %}
    <div class="novel-detail-section">
        {% with hide_edit_button=True %}
            {% include 'novels/novel_detail_section.html' %}
        {% endwith %}
    </div>
    <hr style="margin-top: 0;">
    <p class="toggle-message" id="message-warning" style="display:none;">
        â†‘ã“ã‚“ãªæ„Ÿã˜ã®ä»•ä¸ŠãŒã‚Šã‚„ï¼ã€€æ°—ã«å…¥ã‚‰ã¸ã‚“ã®ãªã‚‰ä¸‹â†“ã®æ¬„ã§ç·¨é›†ã—ã¦ã‚„ãƒ¼
        <button class="toggle-message-button">éè¡¨ç¤º</button>
    </p>
{% endif %}

<style>
    /* PCã¨ãƒ¢ãƒã‚¤ãƒ«å…±é€šã®å¼·åŠ›ãªãƒ™ãƒ¼ã‚¹ã‚¹ã‚¿ã‚¤ãƒ« */
    html body .container .form-group,
    html body .container form .form-group {
        margin-bottom: 2rem !important;
        padding: 0 !important;
        background-color: transparent !important;
        border-radius: 0 !important;
        box-shadow: none !important;
    }

    html body .container .form-group label,
    html body .container form label {
        font-size: 1.1rem !important;
        font-weight: 600 !important;
        color: #2c3e50 !important;
        text-transform: uppercase !important;
        letter-spacing: 0.1em !important;
        margin-bottom: 0.5rem !important;
        display: inline-block !important;
        position: relative !important;
        padding-left: 1rem !important;
        border-left: 4px solid #3498db !important;
        transition: all 0.3s ease !important;
    }

    html body .container .form-group .form-control,
    html body .container .form-group .genre-select,
    html body .container .form-group .initial-select,
    html body .container form select,
    html body .container form input[type="text"],
    html body .container form textarea {
        font-size: 1.1rem !important;
        padding: 1rem !important;
        border: 2px solid #e0e0e0 !important;
        border-radius: 12px !important;
        background-color: #f8f9fa !important;
        transition: all 0.3s ease !important;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05) !important;
    }

    /* å†…å®¹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®é«˜ã•ã‚’ç‰¹åˆ¥ã«è¨­å®š */
    textarea#content {
        width: 100% !important;  /* ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨åŒã˜å¹…ã« */
        min-height: 500px !important;
        padding: 1.5rem !important;
        font-size: 1.1rem !important;
        line-height: 1.8 !important;
        border: 2px solid #e0e0e0 !important;
        border-radius: 12px !important;
        background-color: #f8f9fa !important;
        resize: vertical !important;
        transition: all 0.3s ease !important;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05) !important;
        margin: 0 !important;
        padding-left: 1rem !important;
        padding-right: 1rem !important;
    }

    /* ã‚¹ãƒãƒ›å¯¾å¿œ */
    @media (max-width: 768px) {
        /* ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã®ä½™ç™½ã‚’ãƒªã‚»ãƒƒãƒˆ */
        .container {
            margin: 0 !important;
            padding: 0 !important;
            max-width: none !important;
            width: 100vw !important;  /* ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆå¹…ã„ã£ã±ã„ã« */
            overflow-x: hidden !important;  /* ã¯ã¿å‡ºã—ã‚’é˜²ã */
        }

        /* form-groupã®ä½™ç™½ã‚’ãƒªã‚»ãƒƒãƒˆ */
        .form-group {
            padding: 0 !important;
            margin: 0 !important;
        }

        textarea#content {
            width: calc(100vw - 70px) !important;  /* ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆå¹…ã‹ã‚‰å·¦ä½™ç™½ã ã‘å¼•ã */
            margin-left: 30px !important;
            margin-right: 0 !important;
            min-height: 80vh !important;
            font-size: 23px !important;
            padding: 0.5rem !important;
            padding-right: 0 !important;
            margin-bottom: 1rem !important;
            line-height: 1.8 !important;
        }
    }

    /* ãƒ›ãƒãƒ¼åŠ¹æœï¼ˆPCã®ã¿ï¼‰ */
    @media (min-width: 769px) {
        html body .container form .form-control:hover,
        html body .container form select:hover,
        html body .container form input[type="text"]:hover,
        html body .container form textarea:hover {
            border-color: #007bff !important;
            box-shadow: 0 6px 12px rgba(0,0,0,0.15) !important;
            transform: translateY(-2px) !important;
        }
    }

    /* ã‚³ãƒ³ãƒ†ãƒŠã®å¹…ç™½ã‚’èª¿æ•´ */
    html body .container {
        max-width: 100% !important;  /* 800pxã®åˆ¶é™ã‚’è§£é™¤ */
        padding: 0 0.5rem !important;  /* å·¦å³ã®ä½™ç™½ã‚’æœ€å°é™ã« */
        margin: 0 !important;  /* ãƒãƒ¼ã‚¸ãƒ³ã‚’å®Œå…¨ã«å‰Šé™¤ */
        width: 100% !important;
    }

    /* PCå‘ã‘ã®ç‰¹åˆ¥èª¿æ•´ã‚’ä¸Šæ›¸ã */
    @media (min-width: 769px) {
        html body .container {
            max-width: 100% !important;  /* PCã§ã‚‚æœ€å¤§å¹…åˆ¶é™ã‚’è§£é™¤ */
            padding: 0 1rem !important;
            margin: 0 !important;
        }
        
        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ä½™ç™½ã‚‚èª¿æ•´ */
        .main-content {
            padding-top: 20px !important;
            padding-left: 0 !important;
            padding-right: 0 !important;
            margin: 0 !important;
        }
    }

    /* ãƒ•ã‚©ãƒ¼ãƒ ã‚°ãƒ«ãƒ¼ãƒ—ã®ä½™ç™½èª¿æ•´ */
    html body .container .form-group {
        margin-bottom: 0.8rem !important;
        padding: 0 !important;
    }

    /* å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ä½™ç™½èª¿æ•´ */
    html body .container .form-group .form-control,
    html body .container .form-group .genre-select,
    html body .container .form-group .initial-select {
        margin-bottom: 0.5rem !important;
        padding: 0.6rem !important;
    }

    /* ãƒ¢ãƒã‚¤ãƒ«å‘ã‘ã®èª¿æ•´ */
    @media (max-width: 768px) {
        /* å…¨ä½“ã®ãƒªã‚»ãƒƒãƒˆ */
        html, body {
            margin: 0 !important;
            padding: 0 !important;
            overflow-x: hidden !important;
            width: 100% !important;
        }

        /* main-contentã®ãƒªã‚»ãƒƒãƒˆ */
        .main-content {
            margin: 0 !important;
            padding: 0 !important;
            width: 100% !important;
        }

        /* Bootstrapã®ã‚³ãƒ³ãƒ†ãƒŠãƒªã‚»ãƒƒãƒˆ */
        .container {
            margin: 0 !important;
            padding: 0 !important;
            max-width: none !important;
            width: 100% !important;
            --bs-gutter-x: 0 !important;
            --bs-gutter-y: 0 !important;
        }

        /* ãƒ•ã‚©ãƒ¼ãƒ ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒªã‚»ãƒƒãƒˆ */
        .form-group {
            margin: 0 !important;
            padding: 0 !important;
            background: none !important;
            border-radius: 0 !important;
            box-shadow: none !important;
        }

        /* ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ç”¨ã®form-groupã ã‘ã‚’ç‰¹åˆ¥æ‰±ã„ */
        #content {
            position: static !important;  /* fixedã‚’è§£é™¤ */
            width: 100% !important;
            height: 50vh !important;  /* ç”»é¢ã®åŠåˆ†ã®é«˜ã•ã«å›ºå®š */
            margin: 0.5rem 0 !important;
            padding: 0.8rem !important;
            border: 2px solid #666 !important;
            border-radius: 8px !important;
            overflow-y: auto !important;  /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã« */
            font-size: 20px !important;
            line-height: 1.8 !important;
            -webkit-overflow-scrolling: touch !important;
            touch-action: pan-y !important;
            overscroll-behavior: contain !important; /* ãƒã‚¦ãƒ³ã‚¹åŠ¹æœã‚’åˆ¶å¾¡ */
            will-change: transform !important; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æ”¹å–„ */
        }

        /* ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã®ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚‚èª¿æ•´ */
        #content::placeholder {
            font-size: 18px !important;
            color: #888 !important;
        }

        /* å…¥åŠ›æ™‚ã®ãƒ•ã‚©ãƒ³ãƒˆã‚’èª­ã¿ã‚„ã™ã */
        #content:focus {
            background-color: #fff !important;
            box-shadow: 0 0 5px rgba(0,0,0,0.2) !important;
        }

        /* ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®ãƒ©ãƒ™ãƒ«ã‚’è¡¨ç¤º */
        #content + label,
        label[for="id_content"] {
            display: block !important;  /* éè¡¨ç¤ºã‚’è§£é™¤ */
        }

        /* ãƒ•ã‚©ãƒ¼ãƒ ã‚°ãƒ«ãƒ¼ãƒ—ã®ä½™ç™½å¾©æ´» */
        .form-group {
            margin: 0.5rem 0 !important;
            padding: 0 0.5rem !important;
        }

        /* mt-5ã‚¯ãƒ©ã‚¹ã®ä¸Šãƒãƒ¼ã‚¸ãƒ³ã‚’æ¶ˆã™ */
        .mt-5 {
            margin-top: 0 !important;
        }

        /* formè¦ç´ ã®ä½™ç™½ã‚’æ¶ˆã™ */
        form {
            margin: 0 !important;
            padding: 0 !important;
        }
    }

    /* ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ«å¼·åŒ– */
    html body .container form input::placeholder,
    html body .container form textarea::placeholder {
        color: #666 !important;
        font-size: 1.2rem !important;
        opacity: 0.8 !important;
        font-weight: 500 !important;
    }

    /* ã‚³ãƒ³ãƒ†ãƒŠã¨ãƒ•ã‚©ãƒ¼ãƒ ã®ä½™ç™½èª¿æ•´ */
    html body .container.mt-5 {
        margin-top: 0 !important;
        padding: 0.5rem !important;
    }

    html body .container form {
        margin: 0 !important;
        padding: 0 !important;
    }

    /* form-groupã®ä½™ç™½ã‚’ã•ã‚‰ã«èª¿æ•´ */
    html body .container .form-group {
        margin-bottom: 1rem !important;  /* 2remã‹ã‚‰1remã«ã•ã‚‰ã«ç¸®å° */
    }

    /* ãƒ©ãƒ™ãƒ«ã®ä½™ç™½ã‚‚èª¿æ•´ */
    html body .container .form-group label {
        margin-bottom: 0.5rem !important;  /* 1.2remã‹ã‚‰0.5remã«ç¸®å° */
    }

    /* å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ä½™ç™½èª¿æ•´ */
    html body .container .form-group .form-control,
    html body .container .form-group .genre-select,
    html body .container .form-group .initial-select {
        margin-bottom: 1rem !important;  /* 2remã‹ã‚‰1remã«ç¸®å° */
        padding: 0.8rem !important;  /* 1.2remã‹ã‚‰0.8remã«ç¸®å° */
    }

    /* ãƒœã‚¿ãƒ³ã®ä½™ç™½èª¿æ•´ */
    html body .container form button {
        margin: 0.5rem 0.5rem 0.5rem 0 !important;
    }

    /* main-contentã®ä½™ç™½èª¿æ•´ */
    .main-content {
        padding-top: 20px !important;  /* 70pxã‹ã‚‰20pxã«ç¸®å° */
        margin: 0 !important;
    }

    /* ã‚³ãƒ³ãƒ†ãƒŠã®ä½™ç™½ã‚’ã•ã‚‰ã«èª¿æ•´ */
    html body .container.mt-5 {
        margin: 0 !important;
        padding: 0.5rem !important;
    }

    /* ãƒ•ã‚©ãƒ¼ãƒ ã‚°ãƒ«ãƒ¼ãƒ—é–“ã®ä½™ç™½ã‚’ã•ã‚‰ã«ç¸®å° */
    html body .container .form-group {
        margin-bottom: 0.8rem !important;  /* 1remã‹ã‚‰ç¸®å° */
    }

    /* å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ä½™ç™½ã‚‚å¾®èª¿æ•´ */
    html body .container .form-group .form-control,
    html body .container .form-group .genre-select,
    html body .container .form-group .initial-select {
        margin-bottom: 0.8rem !important;
        padding: 0.6rem !important;
    }

    /* ãƒ©ãƒ™ãƒ«ã®ä½™ç™½ã‚‚å¾®èª¿æ•´ */
    html body .container .form-group label {
        margin-bottom: 0.3rem !important;
    }

    /* ã‚¹ãƒãƒ›å‘ã‘ã®ãƒãƒ¼ã‚¸ãƒ³èª¿æ•´ */
    @media (max-width: 768px) {
        /* æ–°è¦æŠ•ç¨¿æ™‚ã®ä¸Šéƒ¨ãƒãƒ¼ã‚¸ãƒ³ */
        .main-content {
            margin-top: 60px !important;
        }

        /* ç·¨é›†æ™‚ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸‹ã®ãƒãƒ¼ã‚¸ãƒ³ */
        .novel-detail-section + hr {
            margin-top: 60px !important;
        }
    }

    /* PCãƒ»ã‚¹ãƒãƒ›å…±é€šã®ãƒãƒ¼ã‚¸ãƒ³è¨­å®š */
    .main-content {
        margin-top: 60px !important;  /* æ–°è¦æŠ•ç¨¿æ™‚ã®ä¸Šéƒ¨ãƒãƒ¼ã‚¸ãƒ³ã‚’60pxã« */
    }

    /* ç·¨é›†æ™‚ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸‹ã®ãƒãƒ¼ã‚¸ãƒ³ï¼ˆPCãƒ»ã‚¹ãƒãƒ›å…±é€šï¼‰ */
    .novel-detail-section + hr {
        margin-top: 60px !important;  /* ç·¨é›†æ™‚ã®ãƒãƒ¼ã‚¸ãƒ³ã‚‚60pxã« */
    }

    /* PCå‘ã‘ã®è¿½åŠ èª¿æ•´ */
    @media (min-width: 769px) {
        .main-content {
            margin-top: 60px !important;
        }
        
        .novel-detail-section + hr {
            margin-top: 60px !important;
        }
    }

    /* ã‚¹ãƒãƒ›å‘ã‘ã®èª¿æ•´ */
    @media (max-width: 768px) {
        .main-content {
            margin-top: 60px !important;
        }
        
        .novel-detail-section + hr {
            margin-top: 60px !important;
        }
    }

    /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ  */
    .form-control[readonly],
    .form-control[disabled] {
        background-color: #e9ecef !important;  /* è–„ã„ã‚°ãƒ¬ãƒ¼ */
        opacity: 0.7 !important;               /* å°‘ã—é€æ˜ã« */
        cursor: not-allowed !important;        /* ç·¨é›†ä¸å¯ã®ã‚«ãƒ¼ã‚½ãƒ« */
        color: #6c757d !important;            /* ãƒ†ã‚­ã‚¹ãƒˆã‚’å°‘ã—è–„ã */
        border-color: #ced4da !important;      /* ãƒœãƒ¼ãƒ€ãƒ¼ã‚‚è–„ã */
    }

    /* ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    button[type="submit"],
    .btn-save,
    .btn-rest,
    .btn-publish,
    .btn-delete {
        height: 38px !important;
        line-height: 1 !important;
        padding: 0 15px !important;
        margin: 0 10px 0 0 !important;
        display: inline-flex !important;
        align-items: center !important;
        justify-content: center !important;
        vertical-align: middle !important;
        border-radius: 20px !important;
        font-size: 20px !important;
        font-weight: bold !important;
        min-width: 80px !important;  /* æœ€å°å¹…ã‚’è¨­å®š */
    }

    /* ãƒãƒ¼ã‚¸ãƒ³ãƒ»ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å®Œå…¨ã«ãƒªã‚»ãƒƒãƒˆ */
    button[type="submit"].btn,
    .btn-save,
    .btn-rest,
    .btn-publish,
    .btn-delete {
        margin-top: 0 !important;
        margin-bottom: 0 !important;
        padding-top: 0 !important;
        padding-bottom: 0 !important;
    }

    /* ãƒœã‚¿ãƒ³å†…ã®è¦ç´ ã‚‚å¼·åˆ¶çš„ã«ä¸­å¤®æƒãˆ */
    button[type="submit"] span,
    button[type="submit"] img {
        line-height: 38px !important;
        vertical-align: middle !important;
        margin: auto 4px !important;
    }

    /* ãƒœã‚¿ãƒ³ã‚°ãƒ«ãƒ¼ãƒ—ã®ã‚³ãƒ³ãƒ†ãƒŠ */
    form .button-group {
        display: flex !important;
        align-items: center !important;
        gap: 10px !important;
        margin: 20px 0 !important;
        height: 38px !important;
    }

    /* ã‚¹ãƒãƒ›å‘ã‘ã®ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´ */
    @media (max-width: 768px) {
        button[type="submit"],
        .btn-save,
        .btn-rest,
        .btn-publish,
        .btn-delete {
            min-width: 60px !important;
            padding: 0 8px !important;
            margin: 0 5px 0 0 !important;
            font-size: 16px !important;
        }

        /* ã‚¹ãƒã§ã¯ã‚¢ã‚¤ã‚³ãƒ³ã‚’éè¡¨ç¤ºã« */
        button[type="submit"] img,
        .btn-save img,
        .btn-rest img,
        .btn-publish img,
        .btn-delete img {
            display: none !important;
        }

        /* ãƒœã‚¿ãƒ³å†…ã®ãƒ†ã‚­ã‚¹ãƒˆã®ãƒãƒ¼ã‚¸ãƒ³ã‚’èª¿æ•´ */
        button[type="submit"] span,
        .btn-save span,
        .btn-rest span,
        .btn-publish span,
        .btn-delete span {
            margin: 0 !important;
            padding: 0 !important;
        }

        /* ãƒœã‚¿ãƒ³ã‚°ãƒ«ãƒ¼ãƒ—ã®é–“éš”ã‚’èª¿æ•´ */
        form .button-group {
            gap: 5px !important;
        }
    }

    /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
    html body .container form .form-control:focus,
    html body .container form select:focus,
    html body .container form input[type="text"]:focus,
    html body .container form textarea:focus {
        border-color: #3498db !important;
        box-shadow: 0 0 0 3px rgba(52,152,219,0.2) !important;
        outline: none !important;
        transform: translateY(-2px) !important;
    }

    /* ãƒ›ãƒãƒ¼æ™‚ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
    html body .container form .form-control:hover,
    html body .container form select:hover,
    html body .container form input[type="text"]:hover,
    html body .container form textarea:hover {
        border-color: #3498db !important;
        background-color: #ffffff !important;
    }

    /* ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    html body .container form input::placeholder,
    html body .container form textarea::placeholder {
        color: #95a5a6 !important;
        font-style: italic !important;
        opacity: 0.7 !important;
    }

    /* ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®ç‰¹åˆ¥ã‚¹ã‚¿ã‚¤ãƒ« */
    html body .container .form-group .genre-select,
    html body .container .form-group .initial-select {
        appearance: none !important;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%233498db' d='M6 8.825L1.175 4 2.238 2.938 6 6.7l3.763-3.762L10.825 4z'/%3E%3C/svg%3E") !important;
        background-repeat: no-repeat !important;
        background-position: right 1rem center !important;
        padding-right: 2.5rem !important;
    }

    /* å†…å®¹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®é«˜ã•è¨­å®šã‚’ä¿®æ­£ */
    textarea.content {
        min-height: 500px !important;
        height: auto !important;
        overflow-y: visible !important;  /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åˆ¶é™ã‚’è§£é™¤ */
        resize: vertical !important;     /* å‚ç›´æ–¹å‘ã®ãƒªã‚µã‚¤ã‚ºã‚’è¨±å¯ */
        box-sizing: border-box !important;
        line-height: 1.5 !important;    /* è¡Œé–“ã‚’èª¿æ•´ */
    }

    /* ãƒ¢ãƒã‚¤ãƒ«å‘ã‘ã®èª¿æ•´ã‚’ã•ã‚‰ã«ä¿®æ­£ */
    @media (max-width: 768px) {
        textarea.content, textarea.content2 {  /* content2ã‚¯ãƒ©ã‚¹ã‚‚å¯¾è±¡ã«è¿½åŠ  */
            /* åŸºæœ¬è¨­å®š */
            position: relative !important;
            width: 100% !important;
            min-height: 50vh !important;
            height: auto !important;
            
            /* ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰è¡¨ç¤ºæ™‚ã®å¯¾ç­– */
            padding: 1rem !important;
            margin-bottom: 50vh !important;  /* ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆã®åŠåˆ†ã®ä½™ç™½ */
        }
        
        /* ã‚³ãƒ³ãƒ†ãƒŠè‡ªä½“ã«ã‚‚å¤§ããªä½™ç™½ã‚’ç¢ºä¿ */
        .container {
            padding-bottom: 50vh !important;  /* ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆã®åŠåˆ†ã®ä½™ç™½ */
        }
    }

    /* ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®åˆ¶é™è§£é™¤ */
    textarea.content, textarea.content2 {
        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é–¢é€£ã®åˆ¶é™ã‚’å…¨ã¦è§£é™¤ */
        overflow: visible !important;
        -webkit-overflow-scrolling: auto !important;
        overscroll-behavior: auto !important;
        
        /* åŸºæœ¬è¨­å®š */
        width: 100% !important;
        min-height: 500px !important;
        height: auto !important;
        resize: vertical !important;
        line-height: 1.5 !important;
    }

    /* ãƒ¢ãƒã‚¤ãƒ«å‘ã‘ã®èª¿æ•´ */
    @media (max-width: 768px) {
        textarea.content, textarea.content2 {
            min-height: 50vh !important;
            padding: 1rem !important;
        }
    }

    /* ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã‚’é¢¨èˆ¹ã®ã‚ˆã†ã«è‡ªç”±ã«ä¼¸ç¸® */
    textarea.content, textarea.content2 {
        /* é«˜ã•ã®åˆ¶é™ã‚’å®Œå…¨è§£é™¤ */
        height: auto !important;
        min-height: 0 !important;
        max-height: none !important;
        
        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é–¢é€£ã®è¨­å®šã‚’å¤‰æ›´ */
        overflow: visible !important;  /* hiddenã‹ã‚‰visibleã«å¤‰æ›´ */
        -webkit-overflow-scrolling: touch !important;  /* ã‚¹ãƒ ãƒ¼ã‚ºã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æœ‰åŠ¹åŒ– */
        overscroll-behavior: auto !important;  /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã®ç¶™ç¶šã‚’è¨±å¯ */
        
        /* åŸºæœ¬è¨­å®š */
        width: 100% !important;
        line-height: 1.5 !important;
        padding: 1rem !important;
        
        /* ã‚µã‚¤ã‚ºå¤‰æ›´ã¯ç¸¦æ–¹å‘ã®ã¿è¨±å¯ */
        resize: vertical !important;
    }

    /* ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã‚’ã‚·ãƒ³ãƒ—ãƒ«ãªå…¥åŠ›ã‚¨ãƒªã‚¢ã¨ã—ã¦æ‰±ã† */
    textarea.content, textarea.content2 {
        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ©Ÿèƒ½ã‚’å®Œå…¨ã‚ªãƒ• */
        overflow: auto !important;
        -webkit-overflow-scrolling: unset !important;
        overscroll-behavior: none !important;
        
        /* é«˜ã•ã¯è‡ªç”±ã«ä¼¸ã³ã‚‹ */
        height: auto !important;
        min-height: 300px !important;
        max-height: none !important;
        
        /* åŸºæœ¬è¨­å®š */
        width: 100% !important;
        line-height: 1.5 !important;
        padding: 1rem !important;
        
        /* ãƒªã‚µã‚¤ã‚ºæ©Ÿèƒ½ã‚ªãƒ• */
        resize: none !important;
    }

    /* ã‚³ãƒ³ãƒ†ãƒŠè‡ªä½“ã«ä½™ç™½ã‚’è¿½åŠ  */
    .container {
        padding-left: 30px !important;  /* å·¦ã®ä½™ç™½ã‚’åºƒã’ã‚‹ */
        padding-right: 30px !important; /* å³ã®ä½™ç™½ã‚’åºƒã’ã‚‹ */
        max-width: 90% !important;      /* å…¨ä½“ã®å¹…ã‚’å°‘ã—ç‹­ã‚ã‚‹ */
        margin: 0 auto !important;      /* ä¸­å¤®å¯„ã› */
    }

    /* ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    textarea.content, textarea.content2 {
        width: 100% !important;
        height: auto !important;
        min-height: 300px !important;
        padding: 1rem !important;
        
        /* æ—¢å­˜ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¨­å®šã¯ãã®ã¾ã¾ */
        overflow: auto !important;
        -webkit-overflow-scrolling: unset !important;
        overscroll-behavior: none !important;
    }

    /* ã‚³ãƒ³ãƒ†ãƒŠè‡ªä½“ã®ä½™ç™½ã‚’å¼·åˆ¶çš„ã«è¨­å®š */
    .container {
        padding-left: 30px !important;
        padding-right: 30px !important;
        max-width: 90% !important;
        margin: 0 auto !important;
    }

    /* ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    textarea.content, textarea.content2 {
        width: 100% !important;
        height: auto !important;
        min-height: 300px !important;
        padding: 1rem !important;
        
        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é–¢é€£ã®è¨­å®šã‚‚å…¨éƒ¨ !important ä»˜ã‘ã¾ã™ */
        overflow: auto !important;
        -webkit-overflow-scrolling: unset !important;
        overscroll-behavior: none !important;
        resize: none !important;
        
        /* ä½™ç™½ã‚‚ !important ã§æŒ‡å®š */
        margin-left: 20px !important;
        margin-right: 20px !important;
    }

    /* ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã¨ãã®è¦ªè¦ç´ ã®ä½™ç™½ã‚’èª¿æ•´ï¼ˆåŠåˆ†ã«ï¼‰ */
    .form-group {
        padding-left: 15px !important;   /* 30px â†’ 15px */
        padding-right: 15px !important;  /* 30px â†’ 15px */
        margin-left: 15px !important;    /* 30px â†’ 15px */
        margin-right: 15px !important;   /* 30px â†’ 15px */
    }

    textarea.content2, 
    textarea.form-control.content2 {
        width: calc(100% - 30px) !important;  /* 60px â†’ 30px */
        margin-left: 15px !important;         /* 30px â†’ 15px */
        margin-right: 15px !important;        /* 30px â†’ 15px */
        height: auto !important;
        min-height: 300px !important;
        
        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é–¢é€£ã®è¨­å®šã¯ãã®ã¾ã¾ */
        overflow: auto !important;
        -webkit-overflow-scrolling: unset !important;
        overscroll-behavior: none !important;
        resize: none !important;
    }

    /* ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
    html body textarea.content, 
    html body textarea.form-control.content,
    html body textarea.content2, 
    html body textarea.form-control.content2 {
        width: calc(100% - 13px) !important;
        height: 70vh !important;  /* ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆã®70%ã§å›ºå®š */
        min-height: 500px !important;
        padding: 15px !important;
        margin: 3px !important;
        
        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¨­å®š */
        overflow-y: auto !important;
        overflow-x: hidden !important;
        resize: vertical !important;
        
        /* ãã®ä»–ã®è¨­å®š */
        line-height: 1.5 !important;
        font-size: 20px !important;
    }
</style>

<div class="container mt-5">
    <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”¨ã®ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’ä¿®æ­£ -->
    {% if form.errors %}
    <div id="errorDialog" class="modal fade show" style="display: block; background-color: rgba(0,0,0,0.3);">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border-radius: 20px; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <div class="modal-header" style="background-color: #ff69b4; color: white; border-top-left-radius: 20px; border-top-right-radius: 20px; border-bottom: none;">
                    <h5 class="modal-title" style="font-size: 1.2rem;">
                        <i class="fas fa-exclamation-circle" style="margin-right: 8px;"></i>
                        ã¡ã‚‡ã£ã¨ä¿®æ­£ãŒå¿…è¦ã¿ãŸã„ã‚„ã§ï¼
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="closeErrorDialog()" style="filter: brightness(0) invert(1);"></button>
                </div>
                <div class="modal-body" style="padding: 20px;">
                    <ul style="list-style-type: none; padding: 0;">
                        {% for field in form %}
                            {% for error in field.errors %}
                                <li style="color: #ff69b4; margin-bottom: 10px; font-size: 1rem;">
                                    <i class="fas fa-info-circle" style="margin-right: 5px;"></i>
                                    <strong>{{ field.label }}:</strong> {{ error }}
                                </li>
                            {% endfor %}
                        {% endfor %}
                        {% for error in form.non_field_errors %}
                            <li style="color: #ff69b4; margin-bottom: 10px; font-size: 1rem;">
                                <i class="fas fa-info-circle" style="margin-right: 5px;"></i>
                                {{ error }}
                            </li>
                        {% endfor %}
                    </ul>
                </div>
                <div class="modal-footer" style="border-top: none; padding: 15px;">
                    <button type="button" class="btn" onclick="closeErrorDialog()" 
                        style="background-color: #ff69b4; 
                               color: white; 
                               border-radius: 20px; 
                               padding: 8px 20px;
                               border: none;
                               font-size: 1rem;
                               transition: all 0.3s ease;">
                        ã‚ã‹ãŸï¼
                    </button>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <form method="post" class="needs-validation" novalidate>
        {% csrf_token %}
        <input type="hidden" id="novelId" name="novelId" value="{{ novel.id|default_if_none:'' }}">

        {% if same_title_info %}
        <!-- åŒã‚¿ã‚¤ãƒˆãƒ«ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±è¡¨ç¤º -->
        <div class="alert alert-info" role="alert" style="margin: 20px 0; padding: 15px; border-radius: 10px; background-color: #d1ecf1; border: 2px solid #0c5460;">
            <h5 style="color: #0c5460; font-weight: bold; margin-bottom: 10px;">
                <i class="fas fa-calendar-alt"></i> åŒã‚¿ã‚¤ãƒˆãƒ«ã‚²ãƒ¼ãƒ 
            </h5>
            <p style="font-size: 1.1rem; color: #0c5460; margin: 0;">
                ğŸ“… {{ same_title_info.year }}å¹´{{ same_title_info.month }}æœˆã®åŒã‚¿ã‚¤ãƒˆãƒ«
            </p>
            <p style="font-size: 1.1rem; color: #0c5460; margin: 5px 0 0 0;">
                ğŸ“ ã‚¿ã‚¤ãƒˆãƒ«ï¼š{{ same_title_info.title }}
            </p>
        </div>
        {% endif %}

        {% for field in form %}
        <div class="form-group">
            {% if field.name == 'genre' %}
            <!-- ã‚¸ãƒ£ãƒ³ãƒ«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ç‰¹åˆ¥ãªæ‰±ã„ -->
            <label for="{{ form.genre.id_for_label }}" class="label-spacing">{{ form.genre.label }}</label>
            <select class="form-control genre-select" id="genre" name="{{ form.genre.html_name }}">
                {% for value, label in form.genre.field.choices %}
                    <option value="{{ value }}" {% if form.genre.value == value %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
                {% elif field.name == 'initial' %}
                    <!-- ã‚¤ãƒ‹ã‚·ãƒ£ãƒ«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ˜ç¤ºçš„ãªè¨˜è¿° -->
                    <!-- ã‚¤ãƒ‹ã‚·ãƒ£ãƒ«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ˜ç¤ºçš„ãªè¨˜è¿° -->
                    <label for="initial" class="label-spacing">{{ field.label }}</label>
                    <select class="form-control initial-select" id="initial" name="{{ field.name }}" required>
                        {% for value, label in field.field.choices %}
                            <option value="{{ value }}" {% if field.value == value %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
            {% elif field.name == 'title' %}
                <!-- ã‚¿ã‚¤ãƒˆãƒ«å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ¨ªã«æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’è¿½åŠ  -->
                <label for="{{ field.id_for_label }}" class="label-spacing">{{ field.label }}</label>
                <input type="text" id="title" name="title" class="form-control full-width" value="{{ form.title.value|default_if_none:'' }}" required>
                <div id="titleWordCount" style="position: absolute; right: 10px; top: 0; color: black;">0 / 30æ–‡å­—</div>
            {% elif field.name == 'content' %}
                <!-- å°èª¬ã®å†…å®¹å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ¨ªã«æ—¢å­˜ã®æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’è¿½åŠ  -->
                <label for="{{ field.id_for_label }}" class="label-spacing">{{ field.label }}</label>
                <textarea class="form-control content2" id="content" name="{{ field.name }}" rows="20"
                placeholder="ã“ã“ã«å°èª¬ã®ä¸­èº«ã‚’ãŠæ›¸ãã©ã™ã€‚å£Šã‚Œã¦ãªã‘ã‚Œã°è‡ªå‹•ä¿å­˜ã—ã¦ã‚‹ã¯ãšã€‚ã€‚" maxlength="10000">{{ form.content.value|default_if_none:'' }}</textarea>
            {% elif field.name == 'status' %}
                <label for="{{ field.id_for_label }}" class="label-spacing">{{ field.label }}</label>
                <input type="text" 
                       class="form-control" 
                       value="{% if novel.status == 'published' %}å…¬é–‹{% elif novel.status == 'scheduled' %}äºˆç´„å…¬é–‹{% else %}ä½œæˆä¸­{% endif %}" 
                       readonly 
                       disabled
                       style="background-color: #e9ecef; opacity: 0.7; cursor: not-allowed;">
            {% else %}
                <!-- ãã®ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ -->
                <label for="{{ field.id_for_label }}" class="label-spacing">{{ field.label }}</label>
                {{ field }}
            {% endif %}
            {% for error in field.errors %}
                <div class="alert alert-danger" role="alert">
                    {{ error }}
                </div>
            {% endfor %}
        </div>
    {% endfor %}

        <!-- ä¸‹æ›¸ãã¨ã—ã¦ä¿å­˜ãƒœã‚¿ãƒ³ -->
        {% if edit %}
            {% if novel.maturi_games.all or novel.is_same_title_game %}
                <div class="alert alert-warning" role="alert" style="margin: 20px 0;">
                    <i class="fas fa-exclamation-triangle"></i>
                    {% if novel.maturi_games.all %}
                        <strong>ã“ã®ä½œå“ã¯ç¥­ã‚Šä½œå“ã§ã™ã€‚</strong> ç·¨é›†ã¯ç¥­ã‚Šå°‚ç”¨ã®ç”»é¢ã‹ã‚‰è¡Œã£ã¦ãã ã•ã„ã€‚
                    {% else %}
                        <strong>ã“ã®ä½œå“ã¯åŒã‚¿ã‚¤ãƒˆãƒ«ä½œå“ã§ã™ã€‚</strong> ç·¨é›†ã¯åŒã‚¿ã‚¤ãƒˆãƒ«å°‚ç”¨ã®ç”»é¢ã‹ã‚‰è¡Œã£ã¦ãã ã•ã„ã€‚
                    {% endif %}
                </div>
            {% else %}
                <p class="toggle-message" id="message-warning2" style="display:none;">
                    ä¸‹ä¿å­˜ã‚¿ãƒ³ã¯ã“ã®å ´ã®ã¾ã¾ä¿å­˜ã‚„ï¼<br>ä¼‘æ¯ã¯ä¿å­˜ã—ã¦è‡ªåˆ†ã®éƒ¨å±‹ã‚„ï¼<br>æŠ•ç¨¿ãƒœã‚¿ãƒ³ã¯å…¬é–‹ã—ã¦ä¸€è¦§ã‚„ï¼
                    <button class="toggle-message-button">éè¡¨ç¤º</button>
                </p>

                <div class="button-group">
                    <button type="submit" name="action" value="draft" class="btn btn-secondary btn-save" style="background-color: orchid !important; color: white !important; margin: 0 !important;">
                        <span>ä¿å­˜</span>
                        <img src="{% static 'images/save.svg' %}" alt="Icon" style="height: 24px !important;"> 
                    </button>

                    <button type="submit" name="action" value="rest" class="btn btn-secondary btn-rest" style="background-color: darkgreen !important; color: white !important; margin: 0 !important;">
                        <span>ä¼‘æ¯</span>
                        <img src="{% static 'images/tea.svg' %}" alt="Icon" style="height: 24px !important;">
                    </button>

                    {% if novel.genre == 'ç¥­ã‚Š' %}
                        {% if is_writing_period or novel.status == 'published' %}
                        <button type="submit" name="action" value="publish" class="btn btn-primary btn-publish" style="background-color: #007bff !important; color: white !important; margin: 0 !important;">
                            <span>æŠ•ç¨¿</span>
                            <img src="{% static 'images/post.svg' %}" alt="Icon" style="height: 24px !important;">
                        </button>
                        {% endif %}
                    {% else %}
                        <button type="submit" name="action" value="publish" class="btn btn-primary btn-publish" style="background-color: #007bff !important; color: white !important; margin: 0 !important;">
                            <span>æŠ•ç¨¿</span>
                            <img src="{% static 'images/post.svg' %}" alt="Icon" style="height: 24px !important;">
                        </button>
                    {% endif %}

                    <button type="submit" name="action" value="delete" class="btn btn-primary btn-delete" style="background-color: red !important; color: white !important; margin: 0 !important;" onclick="return confirmDelete()">
                        <span>å‰Šé™¤</span>
                        <img src="{% static 'images/delete.svg' %}" alt="Icon" style="height: 24px !important;">
                    </button>
                </div>
            {% endif %}
        {% else %}
            <div class="button-group">
                <button type="submit" name="action" value="draft" class="btn btn-secondary btn-save" style="background-color: orchid !important; color: white !important; margin: 0 !important;">
                    <span>ä¿å­˜</span>
                    <img src="{% static 'images/save.svg' %}" alt="Icon" style="height: 24px !important;"> 
                </button>
            </div>
        {% endif %}

        <div id="autoSaveStatus" style="display: none; color: green; font-size: 16px; position: fixed; bottom: 100px; right: 20px; background-color: rgba(248, 249, 250, 0.5); padding: 10px; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);"></div>
    </form>
</div>

<!-- ãƒ•ãƒƒã‚¿ãƒ¼å†…ã«æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’è¡¨ç¤º -->
<div id="footerWordCount" style="text-align: center; padding: 10px; color: #fff; background-color: #333;">
    0 / 10,000æ–‡å­—
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var autoSaveTimeout;
    var lastSavedData = {};

    function getCSRFToken() {
        return document.querySelector('[name=csrfmiddlewaretoken]').value;
    }

    function updateLastSavedData() {
        lastSavedData = {
            novel_id: document.getElementById('novelId').value,
            title: document.getElementById('title').value,
            content: document.getElementById('content').value,
            genre: document.getElementById('genre').value,
            initial: document.getElementById('initial').value
        };
        console.log('LastSavedData updated:', lastSavedData);
    }

    function initializeLastSavedData() {
        updateLastSavedData();
    }

    function hasDataChanged() {
        var currentData = {
            novel_id: document.getElementById('novelId').value,
            title: document.getElementById('title').value,
            content: document.getElementById('content').value,
            genre: document.getElementById('genre').value,
            initial: document.getElementById('initial').value
        };
        return JSON.stringify(currentData) !== JSON.stringify(lastSavedData);
    }

    function autoSave() {
        var novelId = document.getElementById('novelId').value;
        var titleElement = document.getElementById('title');
        var contentElement = document.getElementById('content');
        var genreElement = document.getElementById('genre');
        var initialElement = document.getElementById('initial');

        var currentData = {
            novel_id: novelId,
            title: titleElement.value,
            content: contentElement.value,
            genre: genreElement.value,
            initial: initialElement.value
        };

        if (hasDataChanged()) {
            console.log('Auto-saving now...');
            fetch('/novels/auto_save/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCSRFToken()
                },
                body: JSON.stringify(currentData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok: ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                console.log('Save successful:', data);
                updateLastSavedData();

                // å—ã‘å–ã£ãŸ novel_id ã‚’ hidden input è¦ç´ è¨­å®š
                if (data.novel_id) {
                    document.getElementById('novelId').value = data.novel_id;
                }
            })
            .catch(error => {
                console.error('Save failed:', error);
            });
        }
    }

    document.querySelectorAll('input, textarea, select').forEach(input => {
        input.addEventListener('input', () => {
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(autoSave, 20000); // 20ç§’å¾Œã«è‡ªå‹•ä¿å­˜
        });
    });

    initializeLastSavedData();

    // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®æ›´æ–°é–¢æ•°
    function updateWordCount() {
        var titleElement = document.getElementById('title');
        var contentElement = document.getElementById('content');
        var titleCount = titleElement.value.length;
        var contentCount = contentElement.value.length;
        var titleWordCountElement = document.getElementById('titleWordCount');
        var footerWordCountElement = document.getElementById('footerWordCount');

        if (titleWordCountElement) {
            titleWordCountElement.textContent = `${titleCount} / 30æ–‡å­—`;
        }
        if (footerWordCountElement) {
            footerWordCountElement.textContent = `${contentCount} / 10,000æ–‡å­—`;
        }
    }

    // å…¥åŠ›ã‚¤ãƒ™ãƒ³ãƒˆæ–‡å­—æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®æ›´æ–°ã‚’è¿½åŠ 
    document.getElementById('title').addEventListener('input', updateWordCount);
    document.getElementById('content').addEventListener('input', updateWordCount);

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚‚æ–‡å­—æ•°ã‚’æ›´æ–°
    updateWordCount();

    // æ–‡å­—ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®è¡¨ç¤ºåˆ¶å¾¡
    const footerCounter = document.getElementById('footerWordCount');
    let counterTimeout;

    footerCounter.addEventListener('click', function() {
        // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’éè¡¨ç¤ºã«
        this.style.opacity = '0';
        
        // 10åˆ†å¾Œã«å†è¡¨ç¤º (10åˆ† = 600000ãƒŸãƒªç§’)
        clearTimeout(counterTimeout);
        counterTimeout = setTimeout(() => {
            footerCounter.style.opacity = '1';
        }, 600000);  // 10åˆ†ã«å¤‰æ›´
    });

    // ãƒã‚¦ã‚¹ãŒä¹—ã£ãŸã¨ãã«ã¡ã‚‡ã£ã¨æ˜ã‚‹ã
    footerCounter.addEventListener('mouseenter', function() {
        this.style.backgroundColor = '#444';
    });

    // ãƒã‚¦ã‚¹ãŒé›¢ã‚ŒãŸã¨ãã«å…ƒã®è‰²ã«
    footerCounter.addEventListener('mouseleave', function() {
        this.style.backgroundColor = '#333';
    });
});

// æ—¢å­˜ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å‰ã«è¿½åŠ 
function closeErrorDialog() {
    var dialog = document.getElementById('errorDialog');
    if (dialog) {
        dialog.style.display = 'none';
    }
}

// ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚­ãƒ¼ã§ã‚‚ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‰ã˜ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closeErrorDialog();
    }
});

// ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®å¤–å´ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚é–‰ã˜ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹
document.addEventListener('click', function(event) {
    var dialog = document.getElementById('errorDialog');
    if (dialog && event.target === dialog) {
        closeErrorDialog();
    }
});

document.addEventListener('DOMContentLoaded', function() {
    const textarea = document.querySelector('.content2');  // content2ã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨
    const originalHeight = window.innerHeight;
    
    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚ŒãŸæ™‚ã®å‡¦ç†
    window.addEventListener('resize', function() {
        const currentHeight = window.innerHeight;
        
        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚ŒãŸã¨åˆ¤æ–­ã•ã‚Œã‚‹å ´åˆ
        if (currentHeight < originalHeight) {
            // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®ä½ç½®ã‚’è‡ªå‹•èª¿æ•´
            if (document.activeElement === textarea) {
                // ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                setTimeout(() => {
                    textarea.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100);
            }
        }
    });
    
    // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®å‡¦ç†
    textarea.addEventListener('focus', function() {
        // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã«å°‘ã—ä¸Šã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
        setTimeout(() => {
            window.scrollBy(0, -100);
        }, 100);
    });
});

document.addEventListener('DOMContentLoaded', function() {
    const textarea = document.querySelector('.content2');
    
    function adjustHeight() {
        textarea.style.height = 'auto';
        textarea.style.height = textarea.scrollHeight + 'px';
    }
    
    textarea.addEventListener('input', adjustHeight);
    adjustHeight();
});
</script>

{% endblock %}